<div class="mt-2">
    <div id="rule-container"></div>
    <a href="javascript:;" id="add-new-rule" class="add-new-rule">Add rule</a>
    <input id="secgroup" type="hidden" name="{{security_groups_tag_name}}" value""/>
</div>



<script>

let i = 1;
document.getElementById('add-new-rule').onclick = function () {
    let template = `
        <div class="form-row" id="rule-${i}">
          <div enctype='application/json' class="form-group">
            <label>Protocol</label>
            <select class="js-example-basic-single js-states form-control" name="__sc[${i}][protocol]">
              <option value="tcp">TCP</option>
              <option value="udp">UDP</option>
            </select>
          </div>
          <div class="form-group">
            <label>Port Range</label> <br>
            <input type="text" class="form-control" name="__sc[${i}][source]" pattern="(\[[0-9]+,[0-9]+\])|[0-9]+" class="form-control" placeholder="e.g. [8080,8082] or 80" required>
          </div>
          <div class="form-group">
            <label>Source</label> <br>
            <input type="text" class="form-control" name="__sc[${i}][source_cidr]" pattern="[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}.[0-9]{1,3}/[0-9]{1,2}" class="form-control" value="0.0.0.0/0" disabled>
          </div>
          <div class="p-3 mt-2">
            <button type=button class='btn btn-sm btn-outline-danger' href="" onclick="javascript:removeRule('rule-' + ${i} + ''); return false;">Remove</button>
          </div>
        </div>`;

    let container = document.getElementById('rule-container');
    let div = document.createElement('div');
    div.innerHTML = template;
    container.appendChild(div);

    i++;

}

</script>

<style>

label {
  margin-bottom: 0;
  margin-left: 5px;
}

.form-group {
    margin-left: 15px;
}

.add-new-rule {
  background: #6688dd;
  border-radius: 0.25em;
  color: #fff;
  display: inline-block;
  padding: 0.5em;
  text-decoration: none;
}

.remove-rule {
  background: #dd6666;
  border-radius: 0.25em;
  color: #fff;
  display: inline-block;
  padding: 0.5em;
  text-decoration: none;
}
</style>

<script>
function removeRule(elementId) {
    var element = document.getElementById(elementId);
    console.log("id: " + elementId)
    console.log(element)
    element.parentNode.removeChild(element);
}
</script>
